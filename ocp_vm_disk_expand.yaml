---
- name: Expand disk space on a VM 
  hosts: localhost,{{ vm_inventory_hostname }}
  gather_facts: false
  become: false
  vars:
    # pvc_name
    # vmexamples  
    ocp_vm_namespace: "{{ vm_inventory_hostname | split ('-') | first }}"
    ocp_vm_hostname: "{{ vm_inventory_hostname | split ('-') | last }}"
    # size 

  tasks:

# gather pvc claim name 
    - block:
       - name: Gather underlying facts from K8 definition file for {{ vm_inventory_hostname }}
         redhat.openshift_virtualization.kubevirt_vm_info:
            name: "{{ ocp_vm_hostname }}"
            namespace: "{{ ocp_vm_namespace }}" 
         register: ocp_virt_vm_info
   
       - name: Set claim name fact
         ansible.buitlin.set_fact:
            ocp_virt_vm_disk_claimname: ocp_virt_vm_info ['resources'][0]['spec']['template']['spec']['volumes'][0]['persistentVolumeClaim']['claimName']
      delegate_to: localhost
      run_once: true       
    
# expand pvc claim
    - name: expand PVC claim
      community.kubevirt.kubevirt_pvc:
        name: 'move-webapp-vmware-vm-1554529-6snxz'
        namespace: 'vmexamples'
        size: '21Gi'

# gather facts from OS for expanding disk 
# expand VM OS 